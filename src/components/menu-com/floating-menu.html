<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  rel="stylesheet"
/>

<div *ngIf="isSeller" class="fab-wrapper">
  <!-- Nút chính -->
  <button class="fab-main" (click)="toggleMenu()">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Các nút chức năng -->
  <ng-container *ngFor="let action of actions; let i = index">
    <button
      class="fab-action"
      [ngStyle]="getButtonStyle(i)"
      [class.open]="isOpen"
      (click)="action.onClick()"
      [title]="action.label"
    >
      <i [class]="action.icon"></i>
    </button>
  </ng-container>
</div>

<!-- Backdrop cho modal chỉnh sửa -->
<div class="modal-backdrop" *ngIf="showEditModal" (click)="closeEditModal()"></div>

<!-- Modal chỉnh sửa -->
<div class="modal" *ngIf="showEditModal">
  <h3>Chọn sản phẩm để chỉnh sửa</h3>

  <!-- Loading state -->
  <div *ngIf="loadingProducts">Đang tải sản phẩm...</div>

  <!-- Danh sách sản phẩm -->
  <ul *ngIf="!loadingProducts && myProducts.length > 0">
    <li *ngFor="let p of myProducts">
      <i class="fas fa-box"></i>
      {{ p.productName }} - {{ p.price | number:'1.0-0' }} ₫
      <button (click)="selectProductForEdit(p)">Chỉnh sửa</button>
    </li>
  </ul>

  <!-- Không có sản phẩm -->
  <div *ngIf="!loadingProducts && myProducts.length === 0">
    Bạn chưa có sản phẩm nào.
  </div>

  <button (click)="closeEditModal()">Đóng</button>
</div>

<!-- Backdrop cho modal xóa -->
<div class="modal-backdrop" *ngIf="showDeleteModal" (click)="closeDeleteModal()"></div>

<!-- Modal xóa -->
<div class="modal" *ngIf="showDeleteModal">
  <h3>Chọn sản phẩm để xóa</h3>

  <div *ngIf="loadingProducts">Đang tải sản phẩm...</div>

  <ul *ngIf="!loadingProducts && myProducts.length > 0">
    <li *ngFor="let p of myProducts">
      <i class="fas fa-box"></i>
      {{ p.productName }} - {{ p.price | number:'1.0-0' }} ₫
      <button class="danger" (click)="deleteProduct(p)">Xóa</button>
    </li>
  </ul>

  <div *ngIf="!loadingProducts && myProducts.length === 0">
    Bạn chưa có sản phẩm nào.
  </div>

  <button (click)="closeDeleteModal()">Đóng</button>
</div>
<!-- modal doanh thu  -->
<div class="modal revenue-modal" *ngIf="showRevenueModal">
  <h3>Doanh thu tháng {{ filterMonth }}/{{ filterYear }}</h3>

  <div class="revenue-filter">
    <label>
      Tháng:
      <input type="number" [(ngModel)]="filterMonth" min="1" max="12" />
    </label>

    <label>
      Năm:
      <input type="number" [(ngModel)]="filterYear" />
    </label>
  </div>

  <button class="filter-btn" (click)="loadRevenue()">Lọc</button>

  <table class="revenue-table">
    <tr>
      <th>Ngày</th>
      <th>Sản phẩm</th>
      <th>SL</th>
      <th>Giá</th>
      <th>Thành tiền</th>
    </tr>

    <tr *ngFor="let r of revenueData">
      <td>{{ r.date }}</td>
      <td>{{ r.productName }}</td>
      <td>{{ r.quantity }}</td>
      <td>{{ r.price | number:'1.0-0' }} ₫</td>
      <td>{{ r.amount | number:'1.0-0' }} ₫</td>
    </tr>
  </table>

  <div class="revenue-total">
    Tổng doanh thu: {{ totalRevenue | number:'1.0-0' }} ₫
  </div>
  <!-- Mode view -->
<div class="view-mode">
  <button (click)="setViewMode('month')" [class.active]="viewMode==='month'">Theo tháng</button>
  <button (click)="setViewMode('week')" [class.active]="viewMode==='week'">Theo 7 ngày</button>
</div>
<canvas id="revenueChart" width="100" height="50"></canvas>


  <div class="export-buttons">
    <button class="export-excel" (click)="exportExcel()">
      Xuất Excel
    </button>
    <button class="export-pdf" (click)="exportPDF()">
      Xuất PDF
    </button>
  </div>

  <button class="close-btn" (click)="closeRevenueModal()">Đóng</button>
</div>

<!-- Form popup (tạo + chỉnh sửa) -->
<app-product-form
  *ngIf="showProductModal"
  [productData]="selectedProduct"
  (productChange)="onProductChange($event)"
  (close)="closeProductModal()"
>
</app-product-form>
