<div class="admin-dashboard">

    <!-- NÃºt chat ná»•i -->
    <button *ngIf="!isChatOpen" class="floating-chat-btn" (click)="isChatOpen = true">
        ðŸ’¬
    </button>

    <!-- Chat box -->
    <div class="chat-box" *ngIf="isChatOpen">
        <div class="chat-header">
            <b *ngIf="selectedUserId">Chat vá»›i {{ selectedUserEmail }}</b>
            <div class="chat-actions">
                <button class="toggle-users" (click)="showUsers = !showUsers">ðŸ‘¥</button>
                <button class="close-btn" (click)="isChatOpen = false">âœ–</button>
            </div>
        </div>


        <!-- Chat body -->
        <div class="chat-body" *ngIf="selectedUserId">
            <div *ngFor="let msg of messages"
                [ngClass]="{ 'self': isSenderAdmin(msg.sender), 'other': !isSenderAdmin(msg.sender) }">

                <div class="meta">
                    <b>{{ isSenderAdmin(msg.sender) ? 'Admin (' + msg.senderEmail + ')' : msg.senderEmail }}</b>
                    <span class="time">{{ formatTime(msg.timestamp) }}</span>
                </div>


                <div class="bubble"
                    [ngClass]="{ 'admin-msg': isSenderAdmin(msg.sender), 'user-msg': !isSenderAdmin(msg.sender) }">
                    {{ msg.text }}
                </div>
            </div>
            <div #bottomRef></div>
        </div>

        <!-- Chat footer -->
        <div class="chat-footer" *ngIf="selectedUserId">
            <input [(ngModel)]="text" placeholder="Nháº­p tin nháº¯n..." (keyup.enter)="send()">
            <button (click)="send()">Gá»­i</button>
        </div>
    </div>

    <!-- Danh sÃ¡ch User -->
    <div class="user-list-box" *ngIf="showUsers && isChatOpen">
        <h3>Danh sÃ¡ch User</h3>
        <ul>
            <li *ngFor="let u of users" [class.active]="u.userId === selectedUserId"
                (click)="selectUser(u.userId, u.email)">
                {{ u.email || u.userId }}
            </li>
        </ul>
    </div>
</div>